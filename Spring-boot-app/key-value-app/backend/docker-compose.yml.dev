services:
 db:
  image: gvenzl/oracle-xe:21-slim
  container_name: oracle-db
  ports:
   - "1521:1521"
  environment:
   ORACLE_PASSWORD: "oracle"
  volumes:
    - oracle_data_1:/opt/oracle/oradata
  networks:
   - my-app-network1
  healthcheck:
   test: ["CMD", "bash", "-c", "echo 'SELECT 1 FROM dual;' | sqlplus -s system/oracle@localhost/XEPDB1"]
   interval: 10s
   timeout: 5s
   retries: 10
   start_period: 40s
   
 backend:
  build:
   context: .
   dockerfile: Dockerfile.dev

  container_name: key-value-app-dev
  
  networks:
   - my-app-network1
   
  ports:
   - "8080:8080"
   
  volumes:
   - .:/app

  develop:
   watch:
    # Sync Java source changes instantly
    - path: ./src
      target: /app/src
      action: sync

    # If pom.xml changes â†’ rebuild container
    - path: ./pom.xml
      action: rebuild

  environment:
   - SPRING_DEVTOOLS_RESTART_ENABLED=true
   
  depends_on:
   db:
    condition: service_healthy

volumes:
 oracle_data_1:

networks:
  my-app-network1:
    driver: bridge